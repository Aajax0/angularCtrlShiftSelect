angular.module("davidbohunek.ctrlshiftselect",[]).directive("ctrlshiftselect",[function(){return{restrict:"A",controller:function($scope,$element,$attrs){this.selectedClass=$attrs.ctrlshiftselectClass?$attrs.ctrlshiftselectClass:"selected";var lastSelectedItemScope,childItems=[],setSelected=function(modelGetter,scope,value){modelGetter.assign(scope,value),$scope.$digest(),value&&(lastSelectedItemScope=scope)};this.initChild=function(childItem){childItems.push(childItem)},this.onShiftClick=function(element,modelGetter,scope){for(var lastSelectedItemScopeStored=lastSelectedItemScope,isSelecting=!1,i=0;i<childItems.length;i++){var childItem=childItems[i];isSelecting&&setSelected(childItem.modelGetter,childItem.scope,!0),(childItem.scope===scope||childItem.scope===lastSelectedItemScopeStored)&&(isSelecting=!isSelecting),isSelecting&&setSelected(childItem.modelGetter,childItem.scope,!0)}},this.onCtrlClick=function(element,modelGetter,scope){var currentValue=modelGetter(scope);setSelected(modelGetter,scope,!currentValue)},this.onPlainClick=function(element,modelGetter,scope){for(var i=0;i<childItems.length;i++){var childItem=childItems[i];setSelected(childItem.modelGetter,childItem.scope,!1)}setSelected(modelGetter,scope,!0)}}}}]).directive("ctrlshiftselectModel",["$parse",function($parse){return{restrict:"A",require:"^ctrlshiftselect",link:function(scope,element,attributes,controller){var modelGetter=$parse(attributes.ctrlshiftselectModel);controller.initChild({modelGetter:modelGetter,scope:scope}),scope.$watch(attributes.ctrlshiftselectModel,function(newValue){newValue?element.addClass(controller.selectedClass):element.removeClass(controller.selectedClass)}),element.on("mousedown",function(event){return 1!==event.which?!0:void(event.shiftKey?controller.onShiftClick(element,modelGetter,scope):event.ctrlKey?controller.onCtrlClick(element,modelGetter,scope):controller.onPlainClick(element,modelGetter,scope))})}}}]);